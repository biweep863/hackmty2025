datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id               String            @id @default(cuid())
    email            String            @unique
    name             String
    password         String
    ridesOffered     Ride[] @relation("RidesOffered")         
    ridesReserved    Ride[] @relation("RideReservations")
    generatedStops   GeneratedStop[]
}

model Ride {
    id          String   @id @default(cuid())
    driverId    String
    origin      String
    destination String
    latStart    Decimal  @db.Decimal(9, 6)
    lngStart    Decimal  @db.Decimal(9, 6)
    latEnd      Decimal  @db.Decimal(9, 6)
    lngEnd      Decimal  @db.Decimal(9, 6)
    distanceKm  Decimal  @db.Decimal(10, 2)
    price       Decimal  @db.Decimal(10, 2)
    durationMin Int?
    driver      User      @relation("RidesOffered", fields: [driverId], references: [id])
    clients     User[]    @relation("RideReservations")
    createdAt   DateTime  @default(now())
}

enum AvailabilityType {
    ONE_OFF
    RECURRING
}

enum TripStatus {
    OPEN
    LOCKED
    STARTED
    COMPLETED
    CANCELED
}

enum BookingStatus {
    PENDING
    ACCEPTED
    REJECTED
    CANCELED_BY_RIDER
    CANCELED_BY_DRIVER
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

model GeneratedStop {
    id        String   @id @default(cuid())
    label     String?
    lat       Decimal  @db.Decimal(9, 6)
    lng       Decimal  @db.Decimal(9, 6)
    routeHash String? // optional grouping identifier for the route
    creatorId String? // optional user who generated the stops
    creator   User?    @relation(fields: [creatorId], references: [id])
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([creatorId])
}
